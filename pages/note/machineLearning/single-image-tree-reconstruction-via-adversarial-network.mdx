# 通过对抗网络进行的单一图像树重建

> 仅供个人学习使用，如有侵权请联系，将立即删除

> 作者： Zhihao Liua, Kai Wua, Jianwei Guoc, Yunhai Wangd, Oliver Deussena,e and Zhanglin Chenga

> 中国科学院深圳先进技术研究院，中国科学院大学，中国科学院自动化研究所，国家语言资源创新工程（NLPR），山东大学，康斯坦茨大学

> https://doi.org/10.1016/j.gmod.2021.101115

## 关键词

关键词：树木重建、单图像重建、对抗网络

## 摘要

在图形学领域，逼真的3D树木重建仍然是一项繁琐且耗时的任务。本文提出了一种简单高效的方法，通过单张图像实现高保真度的3D树木模型重建。基于单图像的树木重建的关键在于通过从一组合成树木模型中学到的深度神经网络恢复树木的3D形状信息。我们采用了条件生成对抗网络（cGAN）分别从从图像提取的边缘和用户绘制的简单2D笔画中推断出树木的3D轮廓和骨架。基于预测的3D轮廓和骨架，可以利用程序建模技术生成一个在输入图像中保留树木形状的逼真树木模型。对各种树木示例的实验证明了所提方法在从单图像重建逼真3D树木模型方面的高效性和有效性。

## 1. 引言

在过去的几年中，许多树木建模方法已经得到了发展，包括程序化树木建模和从照片或激光扫描中进行的树木重建。程序化树木建模可以合成虚拟树木模型，而树木重建方法则生成真实世界树木的忠实模型。为了为真实树木重建生成逼真的模型，甚至采集输入数据都是昂贵且耗时的，例如使用激光扫描仪获取3D点云或从不同角度仔细拍摄真实树木周围的许多照片。基于单图像的树木重建技术只需一张图像作为输入，极大简化了用于真实树木重建的输入数据要求，从而提供了仅从树木的单个图像生成逼真树木模型的可行解决方案。

![](https://jetzihan-img.oss-cn-beijing.aliyuncs.com/20231223154607.png)

单图像树木重建的关键在于从单个图像中恢复3D信息。先前基于单图像的树木建模方法通常使用一些先验知识推断3D树木形状。例如，Tan等人[47]和Guénard等人[12]通过假设分支之间的距离或投影角尽可能大，将2D分支转换为3D；Argudo等人[1]通过膨胀2D轮廓生成对称的3D树木形状。然而，这些2D到3D的转换是人为设计的，并且过于简单，难以描述2D图像和3D树木模型之间的真实投影。这些方法难以从树木的单个图像生成高保真度的3D模型。尽管从单个图像进行准确的3D重建在一般情况下是不适定的且不可能的，但我们认为通过利用3D树木模型库可以学习3D树木结构的先验知识，并在一定程度上从树木的单个图像中恢复3D信息。因此，我们尝试使用深度学习方法学习底层的2D到3D投影，并从单个图像中推断树木的3D形状。在本文中，我们使用条件生成对抗网络（cGAN）从树木的骨架和轮廓图像中恢复树木的深度信息。

大多数基于深度学习的物体重建方法通常将3D形状表示为体素或点云，并限制于重建相对简单和光滑的形状，如汽车或椅子。然而，树木具有更复杂和详细的微小结构，包括丰富的树枝和叶子，因此直接预测3D树木模型是相当困难的。本文结合了深度学习和程序化树木建模技术，从单个图像生成高质量的树木模型。使用深度神经网络预测树木的基本3D形状，然后通过基于预测形状的程序化建模生成详细的树木模型。我们使用两种表示来描述树木的基本3D形状：一种是骨架，用于表示主要可见的树干；另一种是轮廓，使用点云覆盖树木的外形。这样的骨架和轮廓由两种深度图像编码。因此，问题被转化为图像到图像的翻译任务，而不是直接估计3D形状。我们采用cGAN架构从输入图像推断这些深度图像。我们首先绘制几笔标记可见的树干，并从树木图像中提取边缘。网络以笔画和边缘为输入，并输出相应的骨架和轮廓的深度图像。最后，基于主干的预测骨架，我们采用程序化建模方法[31]在由轮廓定义的形状内生成树木模型。程序化建模方法还用于自动生成大量逼真的树木模型作为训练集。

选择边缘而不是真实照片作为生成3D轮廓的输入的主要原因是，以逼真的照片渲染合成树木的难度大且耗时，因此在合成数据集上训练的网络无法准确地从真实照片中预测深度。然而，使用边缘可以解决这个问题，并减弱纹理颜色和其他变量环境因素（如光照和阴影）的影响，这通常导致网络的收敛失败。此外，边缘描绘了树木的局部形状以及其他重要细节，如内部空洞和树枝叶的密度。3D轮廓为整体树冠形状提供了相对粗略的描述。为了忠实重建主干和可见的树枝，我们使用几笔2D笔画标记可见的树干，cGAN网络直接从用户绘制的笔画中预测骨架的深度。

本文的主要贡献是通过结合深度学习方法和程序化建模，从树木的单个图像实现高保真度的3D树木重建。重建可以在几秒钟内完成，几乎是实时的。

## 2. 相关工作

**程序化树木建模**。基于语法或规则的程序化建模技术为创建复杂的植物模型提供了一种高效的方式[7]。流行的L系统最初由[23]引入，用于描述多细胞发展，然后以各种方式扩展，以建模不同植物类型的几何和结构[36, 35, 34]。另一种广泛使用的程序化方法将树木建模为由少量几何规则特征化的递归分支结构，如分支角度和相邻节间长度比例[15]、隐式函数[3]、分形模型[30]和狭窄的近锥形管道[49]。De Reffye等人[40]还使用一组规则模拟分支结构，但这些规则是由植物生长模型驱动的。Stava等人[46]没有直接编写生成规则，而是将目标多边形模型用作约束，并提出了一种反向程序化方法。他们使用蒙特卡洛马尔可夫链（MCMC）来估计产生与输入相似的植物的程序化模型的最优参数。最近，Guo等人[13]利用深度学习来检测分支结构，并提出了一种学习像素图像的2D L系统表示的反向程序化建模方法。

考虑到环境效应和分支空间之间的影响，提出了空间殖民算法[43, 2]以产生更具说服力的树木形态。Pirk等人[33]提出了一种动态树木建模和表示技术，允许复杂的树木模型与其环境进行交互。Pałubicki等人[31]利用自组织的概念通过模拟芽和分支为光和空间进行竞争来使树木适应环境。然后Yi等人[53]通过将各种生长方程集成到程序化树木建模过程中扩展了这种方法。这些方法通常需要专业知识和手动操作，提供了间接的方式来控制树木建模过程。

**现实世界的树木建模**。为了减少建模工作量，研究人员开发了许多算法来从真实世界的数据中捕捉和重建树木。激光扫描提供了获取树木几何属性的有效工具。从获取的3D点云中，Xu等人[51]和Livny等人[25]利用最小生成图来恢复树枝，然后随机添加小枝和叶子以形成冠形几何。Livny等人[24]提出了一种基于叶片的表示来近似给定数据的几何形状，并通过对每个叶片实例化预定义的补丁来合成完整的植物模型。Yan等人[52]、Raumonen等人[38]和Zhang等人[32, 54]提出了通过局部拟合或搜索圆柱体来实现准确树木建模的圆柱体行进算法。在其他工作中，Friedman和Stamos[9]从输入点云的小波变换中推断形状语法，然后使用语法复制树木结构。Li等人[22]捕捉一系列点云以分析发展中植物的演变部分。

基于图像的技术通常使用多视图图像来提取树木几何的各种表示，以指导建模过程，如视觉包围体[44]、体积表示[39][28]、从结构运动（SFM）获得的点云[37][48][4]。一些研究人员还尝试从视频中生成树木模型[8, 21]。与我们方法最相关的是基于单图像的建模方法。在[47]中，用户至少绘制两笔来识别冠层和树枝。然后，使用2D笔画通过生长引擎引导3D树木合成。Guénard等人[12]提出使用分析合成方法生成3D植物模型，该方法结合了单张图像的信息和植物物种的先验知识。Argudo等人[1]提出了一个完整的流水线，用于以最小用户工作量合成和渲染详细的树木。关键在于通过解决薄板能量最小化问题创建冠层形状的粗略估计，然后通过简化的形状光照法添加细节。

基于深度学习的树木建模方法在图形学领域引起了一些关注。Huang等人[16]提出从用户草图中合成形状，其中深度卷积神经网络（CNN）被训练将草图映射到程序化模型参数。然而，该方法仅适用于合成2D树木。最近的一项工作[17]通过图像到图像的转换从多视图图像中估计3D植物的分支结构。他们结合了图像到图像转换的贝叶斯扩展和3D聚合，生成3D分支概率图。与他们不同，我们从单个图像生成3D树木模型，而推断的深度信息比概率图更精确地表示树枝。

**通过GAN进行图像到图像的转换**。第一个生成对抗网络（GAN）[11]被提出来解决图像生成问题。此后，许多研究人员尝试基于GAN解决传统的基于图像的任务。例如，图像到图像的转换是现代图像处理的基石，它将源图像的可能表示映射到目标图像。Isola等人[18]提出了一个基于cGAN的pix2pix框架，用于从配对图像中学习图像到图像的转换。CycleGAN[55]和DiscoGAN[19]利用周期一致性损失实现不配对的图像到图像的转换。Choi等人[6]提出starGAN来实现使用单个生成器的多域图像转换问题。

**用于3D对象的深度学习**。由于在生成图像方面取得的成功，许多方法尝试应用深度学习进行3D生成或重建。Wu等人[50]通过生成对抗网络在64×64×64的体素上生成新的3D对象。Girdhar等人[10]提出了一个TL嵌入网络，其中包含一系列卷积和全连接层，以从2D图像预测20×20×20的体素。Rezende等人[41]采用条件生成模型从2D图像推断3D体素。然而，体素是对3D对象的低精度表示。Lun等人[26]通过多视图卷积网络从多视图2D草图中重建3D点云。SurfNet[45]通过深度残差网络直接重建3D形状表面，而不是通过体素。然而，这些方法仅限于一些人造规则的对象，如汽车、桌子、床和椅子。而树木模型具有更复杂的结构，没有连续的表面，由丰富的叶子和树枝组成。我们的方法可以从单个图像生成高质量的树木模型。

## 3. 概述

![](https://jetzihan-img.oss-cn-beijing.aliyuncs.com/20231223155306.png)

> 图2：我们树木重建方法的概述。 (a) 输入图像。 (b) Canny检测器提取的边缘。 (c) 用户绘制的用于标记主干的笔画。 (d) 和 (e) cGAN预测的两种深度图像。 (f) 和 (g) 从两种深度图像中恢复的3D轮廓和骨架。 (h) 由程序化建模算法生成的分支结构。 (i) 带有叶子的最终3D树木模型。

在本文中，我们提出通过深度卷积网络从单个图像重建3D树木模型。我们的框架包括如图2所示的三个具体步骤。所提出方法的核心组件是一个条件生成对抗网络（cGAN），它将一个域的图像转换为另一个域。为了训练这样一个神经网络，我们自动产生了大量的合成3D树木模型，并生成图像对的集合作为训练数据集。基于训练数据，我们提出了一个新的损失函数来优化网络参数。

在测试阶段，给定一个输入图像，我们首先使用Canny检测器[5]提取边缘，并绘制几笔简单的笔画来标记主干，如图2（b）和（c）所示。然后训练好的cGAN以边缘和笔画作为输入，并输出两种深度图像（见图2（d）和（e））。这两种深度图像特别设计用于以两种表示存储树木的几何形状：3D轮廓和骨架（见图2（f）和（g））。3D轮廓定义了树木的生长空间，而骨架表示3D可见的主干。最后，基于重建的主干，我们采用程序化建模方法[31]在由轮廓定义的空间内生成完整的3D树木模型。为了生成更自然的树形状，从输入图像计算一个方向图以指导建模过程。图2（h）说明了我们方法生成的分支结构的正面和侧面视图。最终的带有叶子的树木模型在图2（i）中呈现。

## 4. 算法

### 4.1. 训练数据表示

为了获取大量用于训练的树木样本，我们首先通过使用过程建模方法[31]自动收集一组3D树木模型。该树木数据集包含通过使用不同建模参数使用不同树种生成的树木模型。在获取这些树木模型之后，我们可以为训练我们的网络生成图像对。所有图像都设置为大小为 256 × 256，并使用正交投影进行投影。接下来，我们分别介绍预测3D骨架和轮廓的图像对的生成过程。

#### 骨架训练对

为了预测3D骨架，我们网络的输入是一组2D笔画，输出是相应的深度图像（见图3）。给定一个3D树木模型，可以通过使用不同颜色渲染每个分支来直接获得2D笔画，而深度图像可以直接从深度缓冲中提取。在这里，我们使用不同颜色来编码分支，因为颜色可以根据不同笔画的交叉清晰地指示分支的相对位置。这种方法还有助于改善神经网络的收敛性。在我们的框架中，用于标记不同分支的颜色对于每棵树是固定的。此外，所有笔画的宽度都设置为4像素，因为较细的笔画会使收敛变得困难，而较宽的笔画可能会导致线段之间的严重遮挡。最后，我们将渲染窗口大小设置为 256 × 256，并使用正交投影来渲染每个图像对。在这种情况下，深度值位于范围[0, 1]，其中0表示最近的平面，1表示最远的平面。

#### 轮廓训练对

为了估计3D轮廓，网络以边缘图像作为输入，并输出一个用于描绘树体积的特殊深度图像（见图4）。为了获取边缘图像，我们首先对图像应用高斯滤波器（核大小=5）以平滑图像，然后使用Canny检测器提取边缘，其高和低阈值设置为0.8和0.4。为了将3D轮廓存储到单个图像中，我们使用双深度图描绘轮廓，同时编码树的前后两侧的深度值。如图5所示，两个相对视图 퐷1 和 퐷2 在正交投影下获得。为了正确匹配像素对，퐷2 应该首先在水平方向上进行镜像。对于最终的双深度图像，我们使用红色通道（R）存储前视深度，使用绿色通道（G）存储前后视之间的深度间隔，即:

![](https://jetzihan-img.oss-cn-beijing.aliyuncs.com/20231224204811.png)
